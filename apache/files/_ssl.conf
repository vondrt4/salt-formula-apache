
  {%- if site.ssl is defined %}
  {%- if site.ssl.enabled %}
  SSLEngine on
  SSLCertificateFile /etc/ssl/certs/{{ site.host.name }}.crt
  SSLCertificateKeyFile /etc/ssl/private/{{ site.host.name }}.key
  SSLCertificateChainFile /etc/ssl/certs/ca-chain.crt

  {%- if site.ssl.get('strict_transport_security', False) %}
  Header always set Strict-Transport-Security "max-age=63072000; includeSubdomains; preload"
  {%- endif %}

  {%- set ssl_mode = site.ssl.get('mode', 'secure') %}
  {%- include "apache/files/_ssl_"+ssl_mode+".conf" %}

  {%- endif %}

  {%- if site.ssl.force is defined and site.ssl.force %}
  RewriteEngine on
  RewriteCond %{HTTPS} !=on
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
  {%- endif %}

  {%- if site.ssl.force_after_proxy is defined and site.ssl.force_after_proxy %}
  RewriteEngine on
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
  {%- endif %}

  {%- endif %}
